#include "oled.h"
#include "ssd1306.h"
#include "ssd1306_fonts.h"

const unsigned char full[]  = {
	0x00, 0x30, 0x00, 0x00, 0x00, 0x70, 0x03, 0x00, 0x00, 0xf0, 0x03, 0x80, 0x01, 0xf0, 0x01, 0xc0, 
	0x03, 0xf0, 0x30, 0xe0, 0x07, 0xf0, 0x38, 0x60, 0x0f, 0xf6, 0x1c, 0x70, 0x7f, 0xf7, 0x0c, 0x30, 
	0xff, 0xf3, 0x8e, 0x38, 0xff, 0xf1, 0xc6, 0x18, 0xff, 0xf0, 0xc6, 0x18, 0xff, 0xf0, 0xc6, 0x18, 
	0xff, 0xf0, 0xc6, 0x18, 0xff, 0xf0, 0xc6, 0x18, 0xff, 0xf0, 0xc6, 0x18, 0xff, 0xf1, 0xc6, 0x18, 
	0xff, 0xf3, 0x8e, 0x38, 0x7f, 0xf7, 0x0c, 0x30, 0x0f, 0xf6, 0x1c, 0x70, 0x07, 0xf0, 0x38, 0x60, 
	0x03, 0xf0, 0x30, 0xe0, 0x01, 0xf0, 0x01, 0xc0, 0x00, 0xf0, 0x03, 0x80, 0x00, 0x70, 0x03, 0x00, 
	0x00, 0x30, 0x00, 0x00};

const unsigned char play[]  = {
	0x00, 0x00, 0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 0x03, 0xe0, 0x00, 0x00, 
	0x03, 0xe0, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x03, 0xfe, 0x00, 0x00, 
	0x03, 0xfe, 0x00, 0x00, 0x03, 0xff, 0x80, 0x00, 0x03, 0xff, 0x80, 0x00, 0x03, 0xff, 0xe0, 0x00, 
	0x03, 0xff, 0xe0, 0x00, 0x03, 0xff, 0xe0, 0x00, 0x03, 0xff, 0x80, 0x00, 0x03, 0xff, 0x80, 0x00, 
	0x03, 0xfe, 0x00, 0x00, 0x03, 0xfe, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 
	0x03, 0xe0, 0x00, 0x00, 0x03, 0xe0, 0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 0x03, 0x80, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00
};
const unsigned char puse[]  = {
	0x00, 0x00, 0x00, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 
	0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 
	0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 
	0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x7f, 
	0x1f, 0xc0, 0x7f, 0x1f, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const unsigned char logo[]  = {//72x64
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x03, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x04, 0xf2, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0xfe, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x19, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x2e, 0xfc, 0x00, 
	0x00, 0x00, 0x07, 0xfc, 0x00, 0x00, 0x4c, 0xf8, 0x00, 0x30, 0x00, 0x0f, 0xff, 0x80, 0x00, 0x9d, 
	0xf0, 0x00, 0x30, 0x00, 0x0f, 0xff, 0xc0, 0x03, 0xf6, 0xf8, 0x00, 0x30, 0x00, 0x0f, 0xff, 0xc0, 
	0x06, 0xc4, 0xf8, 0x00, 0x30, 0x00, 0x3f, 0xff, 0xc0, 0x0c, 0xcc, 0xf0, 0x00, 0x38, 0x00, 0x7f, 
	0xff, 0xc0, 0x1f, 0x7f, 0xe0, 0x00, 0x38, 0x00, 0xff, 0xff, 0xc0, 0x7e, 0x47, 0xe0, 0x00, 0x7c, 
	0x00, 0xff, 0xff, 0x80, 0x7c, 0xcc, 0xf0, 0x00, 0xfc, 0x00, 0x7f, 0xff, 0xc0, 0x7f, 0x79, 0xe0, 
	0x00, 0xfe, 0x00, 0xff, 0xff, 0xe0, 0x7e, 0x7f, 0xc0, 0x00, 0x7e, 0x01, 0xff, 0xfe, 0x3e, 0xfe, 
	0xcf, 0xc0, 0x00, 0x7b, 0x01, 0xff, 0xfe, 0xbf, 0xff, 0xdb, 0xe0, 0x00, 0x79, 0x81, 0xff, 0xff, 
	0x38, 0x7e, 0x7b, 0xc0, 0x00, 0x3c, 0xc0, 0xfe, 0x7f, 0xf0, 0xff, 0xdf, 0xc0, 0x00, 0xfc, 0xe0, 
	0xfc, 0xff, 0xe0, 0xfe, 0xb3, 0x00, 0x00, 0xfe, 0xd1, 0xfc, 0xff, 0xe1, 0xfc, 0xe6, 0x00, 0x00, 
	0x7f, 0xd9, 0xf8, 0x7f, 0xc3, 0xff, 0xbe, 0x00, 0x00, 0x38, 0xff, 0xf8, 0x7f, 0x0f, 0xf9, 0xfe, 
	0x00, 0x00, 0x3c, 0x7f, 0xf8, 0x30, 0x0f, 0xff, 0xdc, 0x00, 0x00, 0x1e, 0x7f, 0xf0, 0x70, 0x0f, 
	0xfa, 0xf8, 0x00, 0x00, 0x3f, 0xcf, 0xf8, 0x60, 0x07, 0xf7, 0xf0, 0x00, 0x00, 0x3f, 0xff, 0xfc, 
	0x60, 0x07, 0xfd, 0x70, 0x00, 0x00, 0x3e, 0x3f, 0xfc, 0x60, 0x03, 0xef, 0xe0, 0x00, 0x00, 0x1f, 
	0x97, 0xff, 0xe0, 0x01, 0xff, 0xc0, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xe0, 0x00, 0xf5, 0xc0, 0x00, 
	0x0c, 0x03, 0xff, 0xff, 0xe0, 0x00, 0x7f, 0x82, 0x00, 0x3c, 0x07, 0xe2, 0xff, 0xf0, 0x00, 0x1c, 
	0x1c, 0x01, 0xf8, 0x07, 0xff, 0xff, 0xf0, 0x00, 0x1c, 0x38, 0x63, 0xfe, 0x03, 0xff, 0xff, 0xf8, 
	0x00, 0x3f, 0xff, 0xe3, 0xfe, 0x00, 0xfc, 0x7f, 0xfc, 0x00, 0x7f, 0xff, 0xfb, 0xf8, 0x00, 0x3f, 
	0xd7, 0xfe, 0x00, 0xff, 0xff, 0xf1, 0xf0, 0x00, 0x7f, 0x9f, 0xff, 0x83, 0xff, 0xff, 0xff, 0xfc, 
	0x00, 0x1f, 0xf3, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x03, 0xfe, 0xfc, 0x0f, 0xff, 0xff, 
	0xe3, 0xf8, 0x00, 0x03, 0xff, 0xd8, 0x07, 0xe7, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x1f, 0xe0, 0x07, 
	0xc0, 0xff, 0x8f, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x03, 0x80, 0x3d, 0xcf, 0xf8, 0x00, 0x00, 0x00, 
	0x00, 0x03, 0x80, 0x0c, 0x7f, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0x08, 0x7f, 0xf0, 0x00, 
	0x00, 0x00, 0x00, 0x01, 0xe0, 0x01, 0xf8, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x01, 0xfc, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x03, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 
	0x01, 0xcf, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
const unsigned char half[]  = {//23 25
0x00, 0x30, 0x00, 0x00, 0x70, 0x00, 0x00, 0xf0, 0x00, 0x01, 0xf0, 0x00, 0x03, 0xf0, 0x30, 0x07, 
	0xf0, 0x38, 0x0f, 0xf6, 0x1c, 0x7f, 0xf7, 0x0c, 0xff, 0xf3, 0x8e, 0xff, 0xf1, 0xc6, 0xff, 0xf0, 
	0xc6, 0xff, 0xf0, 0xc6, 0xff, 0xf0, 0xc6, 0xff, 0xf0, 0xc6, 0xff, 0xf0, 0xc6, 0xff, 0xf1, 0xc6, 
	0xff, 0xf3, 0x8e, 0x7f, 0xf7, 0x0c, 0x0f, 0xf6, 0x1c, 0x07, 0xf0, 0x38, 0x03, 0xf0, 0x30, 0x01, 
	0xf0, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x70, 0x00, 0x00, 0x30, 0x00};
const unsigned char min[]  = {//18 25
	0x00, 0x30, 0x00, 0x00, 0x70, 0x00, 0x00, 0xf0, 0x00, 0x01, 0xf0, 0x00, 0x03, 0xf0, 0x00, 0x07, 
	0xf0, 0x00, 0x0f, 0xf6, 0x00, 0x7f, 0xf7, 0x00, 0xff, 0xf3, 0x80, 0xff, 0xf1, 0xc0, 0xff, 0xf0, 
	0xc0, 0xff, 0xf0, 0xc0, 0xff, 0xf0, 0xc0, 0xff, 0xf0, 0xc0, 0xff, 0xf0, 0xc0, 0xff, 0xf1, 0xc0, 
	0xff, 0xf3, 0x80, 0x7f, 0xf7, 0x00, 0x0f, 0xf6, 0x00, 0x07, 0xf0, 0x00, 0x03, 0xf0, 0x00, 0x01, 
	0xf0, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x70, 0x00, 0x00, 0x30, 0x00};
const unsigned char zero[]  = {//12 25
	0x00, 0x30, 0x00, 0x70, 0x00, 0xf0, 0x01, 0xf0, 0x03, 0xf0, 0x07, 0xf0, 0x0f, 0xf0, 0x7f, 0xf0, 
	0xff, 0xf0, 0xff, 0xf0, 0xff, 0xf0, 0xff, 0xf0, 0xff, 0xf0, 0xff, 0xf0, 0xff, 0xf0, 0xff, 0xf0, 
	0xff, 0xf0, 0x7f, 0xf0, 0x0f, 0xf0, 0x07, 0xf0, 0x03, 0xf0, 0x01, 0xf0, 0x00, 0xf0, 0x00, 0x70, 
	0x00, 0x30};
const unsigned char mute[]  = {//25 25
	0x00, 0x30, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x01, 0xf0, 0x00, 0x00, 
	0x03, 0xf0, 0x00, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x7f, 0xf1, 0xc3, 0x80, 
	0xff, 0xf1, 0xe7, 0x80, 0xff, 0xf0, 0xff, 0x00, 0xff, 0xf0, 0x7e, 0x00, 0xff, 0xf0, 0x3c, 0x00, 
	0xff, 0xf0, 0x7e, 0x00, 0xff, 0xf0, 0xff, 0x00, 0xff, 0xf1, 0xe7, 0x80, 0xff, 0xf1, 0xc3, 0x80, 
	0xff, 0xf0, 0x00, 0x00, 0x7f, 0xf0, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x07, 0xf0, 0x00, 0x00, 
	0x03, 0xf0, 0x00, 0x00, 0x01, 0xf0, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 
	0x00, 0x30, 0x00, 0x00};

void volume_full(void);
void volume_half(void);
void volume_zero(void);
void volume_mute(void);
void volume_min(void);

extern uint8_t char_width;
volatile uint8_t char_scroll = 0;

void string_scroll(uint8_t* title){
	char_scroll = title[0];
	for(uint8_t i = 0;i<100;i++){
			if(!title[i]){
				title[i-1] = char_scroll;
				break;
			}
			title[i] = title[i+1];
		}
}

void volume_print(bool* flag, char* volume, uint8_t* packet, bool* mute){
	if(*flag){
		ssd1306_ClearBitmapArea(0,10,11*4,18);
		snprintf(volume, 5, "%d%%", *packet);//
		ssd1306_SetCursor(0, 10);
		ssd1306_WriteString(volume,Font_11x18, White);
		if(*mute){volume_mute();}
		else{
			if(*packet>=90)volume_full(); 
			else if(*packet >= 40 &&*packet < 90)	volume_half();
			else if(*packet >= 10 &&*packet < 40)	volume_min(); 
			else	volume_zero();
		} 
		*flag = false;
	}
}

void title_print(bool* flag, uint8_t* packet, uint8_t* title){
	if(*flag){
		for(uint8_t i = 2;i<100;i++){title[i-2] = packet[i];}//
		*flag = false;
	}
	ssd1306_ClearBitmapArea(5,40,SSD1306_WIDTH - 1,40);
	ssd1306_SetCursor(5, 40);
	My_ssd1306_WriteString(title,Font_16x17, &char_width,White);
	string_scroll(title);
}

void state_print(bool* flag, media_state state){
	if(*flag){
		ssd1306_ClearBitmapArea(55,5,25,25);
		switch (state){
					case sPLAY:
						ssd1306_DrawBitmap(55,5,play,25,25,White);			
					break;
					case sPAUSE:
						ssd1306_DrawBitmap(55,5,puse,19,25,White);
					break;
					case sSTOP:
					break;
				}
		*flag = false;
	}	
}

void volume_full(void){
	ssd1306_ClearBitmapArea(99,5,29,25);
	ssd1306_DrawBitmap(99,5,full,29,25,White);
}
void volume_half(void){
	ssd1306_ClearBitmapArea(99,5,29,25);
	ssd1306_DrawBitmap(99,5,half,23,25,White);
}
void volume_min(void){
	ssd1306_ClearBitmapArea(99,5,29,25);
	ssd1306_DrawBitmap(99,5,min,18,25,White);
}
void volume_zero(void){
	ssd1306_ClearBitmapArea(99,5,29,25);
	ssd1306_DrawBitmap(99,5,zero,12,25,White);
}
void volume_mute(void){
	ssd1306_ClearBitmapArea(99,5,29,25);
	ssd1306_DrawBitmap(99,5,mute,25,25,White);
}

void logo_print(void){
	ssd1306_DrawBitmap(32,0,logo,72,64,White);
	ssd1306_UpdateScreen();
	HAL_Delay(5000);
	ssd1306_ClearBitmapArea(32,0,72,64);
}
void oled_init(void){
	ssd1306_Init();}

void oled_update(void){
	ssd1306_UpdateScreen();
}
void clean_oled(void){
	ssd1306_Fill(Black);
	ssd1306_UpdateScreen();
}

